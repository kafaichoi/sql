➜  sql git:(optimize-sql-generation) ✗ mix sql.bench
Compiling 1 file (.ex)
Generated sql app
Operating System: macOS
CPU Information: Apple M1 Max
Number of Available Cores: 10
Available memory: 64 GB
Elixir 1.18.0
Erlang 27.2
JIT enabled: true

Benchmark suite executing with the following configuration:
warmup: 2 s
time: 10 s
memory time: 2 s
reduction time: 0 ns
parallel: 1
inputs: none specified
Estimated total run time: 56 s

Benchmarking Ecto.Repo.to_sql ...
Benchmarking inspect ...
Benchmarking to_sql ...
Benchmarking to_string ...
Calculating statistics...
Formatting results...

Name                       ips        average  deviation         median         99th %
to_sql                  4.74 K        0.21 ms    ±20.20%        0.20 ms        0.32 ms
to_string               4.51 K        0.22 ms     ±3.60%        0.22 ms        0.26 ms
inspect                 0.24 K        4.09 ms     ±2.96%        4.09 ms        4.36 ms
Ecto.Repo.to_sql     0.00757 K      132.03 ms     ±1.45%      131.80 ms      139.43 ms

Comparison:
to_sql                  4.74 K
to_string               4.51 K - 1.05x slower +0.0108 ms
inspect                 0.24 K - 19.39x slower +3.88 ms
Ecto.Repo.to_sql     0.00757 K - 626.20x slower +131.82 ms

Memory usage statistics:

Name                Memory usage
to_sql                   0.38 MB
to_string               0.153 MB - 0.40x memory usage -0.22888 MB
inspect                  4.88 MB - 12.80x memory usage +4.50 MB
Ecto.Repo.to_sql       179.35 MB - 470.13x memory usage +178.97 MB

**All measurements for memory usage were the same**

➜  sql git:(optimize-sql-generation) ✗ mix sql.bench
Compiling 1 file (.ex)
Generated sql app
Operating System: macOS
CPU Information: Apple M1 Max
Number of Available Cores: 10
Available memory: 64 GB
Elixir 1.18.0
Erlang 27.2
JIT enabled: true

Benchmark suite executing with the following configuration:
warmup: 2 s
time: 10 s
memory time: 2 s
reduction time: 0 ns
parallel: 1
inputs: none specified
Estimated total run time: 56 s

Benchmarking ecto ...
Benchmarking inspect ...
Benchmarking to_sql ...
Benchmarking to_string ...
Calculating statistics...
Formatting results...

Name                ips        average  deviation         median         99th %
to_string         27.59       36.24 ms     ±0.75%       36.22 ms       37.21 ms
to_sql            27.45       36.42 ms     ±0.47%       36.39 ms       36.93 ms
inspect           24.53       40.76 ms     ±1.07%       40.75 ms       41.60 ms
ecto               6.96      143.65 ms     ±1.37%      143.36 ms      148.62 ms

Comparison:
to_string         27.59
to_sql            27.45 - 1.00x slower +0.181 ms
inspect           24.53 - 1.12x slower +4.52 ms
ecto               6.96 - 3.96x slower +107.41 ms

Memory usage statistics:

Name         Memory usage
to_string         4.50 MB
to_sql            4.73 MB - 1.05x memory usage +0.23 MB
inspect           9.23 MB - 2.05x memory usage +4.73 MB
ecto            202.87 MB - 45.11x memory usage +198.37 MB

**All measurements for memory usage were the same**
